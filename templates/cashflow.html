<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content="#F2EBDD">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Cash Flow Ledger</title>

  <style>
    :root {
      color-scheme: light only;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* --- Page (desk surface) --- */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #F2EBDD;
      padding: 24px;
      color: #2B2B2B;
      line-height: 1.45;
    }

    /* --- Ledger page --- */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #FBF7EE;
      border: 1px solid #B9AF9F;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }

    /* --- Header (binding/leather) --- */
    .excel-header {
      background: #8B6B3E;
      color: #F8F4EA;
      padding: 14px 20px;
      font-weight: 600;
      letter-spacing: 0.3px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .excel-header a {
      color: #F8F4EA;
      text-decoration: none;
      font-size: 11px;
    }

    /* --- Table --- */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11.5pt;
      font-variant-numeric: tabular-nums;
    }

    thead {
      background: #8B6B3E;
      color: #F8F4EA;
      position: sticky;
      top: 0;
    }

    th {
      padding: 8px;
      text-align: left;
      font-weight: 600;
      border: 1px solid #7A5D36;
    }

    /* --- Ledger striping (very subtle) --- */
    tbody tr:nth-child(odd):not(#input-row) {
      background: #F7F1E3;
    }

    tbody tr:nth-child(even):not(#input-row) {
      background: #FDFBF6;
    }

    tbody tr:hover:not(#input-row) {
      background: #EFE4C8;
    }

    td {
      padding: 6px 8px;
      border: 1px solid #CFC6B8;
      background: transparent;
      color: #2B2B2B;
    }

    td[contenteditable="true"]:focus {
      outline: 2px solid #A38B5F;
      background: #FFFFFF;
    }

    .number {
      text-align: right;
      font-family: 'Courier New', monospace;
    }

    /* --- Input row (receipt tone) --- */
    #input-row {
      background: #FFF9EC;
    }

    #input-row input {
      width: 100%;
      padding: 4px;
      border: 1px solid #CFC6B8;
      font-size: 11pt;
      background: #FFFFFF;
      color: #2B2B2B;
    }

    /* --- Buttons (ink, not UI chrome) --- */
    button {
      padding: 4px 10px;
      margin: 2px;
      border: 1px solid #B9AF9F;
      background: #FBF7EE;
      cursor: pointer;
      font-size: 10pt;
      border-radius: 3px;
      color: #2B2B2B;
    }

    button:hover {
      background: #EFE4C8;
    }

    .delete-btn {
      color: #7A2E2E;
    }

    .save-btn {
      color: #2E6B3F;
      font-weight: bold;
    }

    /* --- Status bar --- */
    .status-bar {
      display: flex;
      justify-content: space-between;
      padding: 8px 20px;
      background: #F7F1E3;
      border-top: 1px solid #CFC6B8;
      font-size: 10pt;
      color: #5A5A5A;
    }
  </style>
</head>

<body>
<div class="container">

  <div class="excel-header">
    <div>Cash Flow Ledger</div>
    <a href="/export-csv">Export CSV</a>
  </div>

  <div class="table-container">
    <table id="cashflow-table">
      <thead>
        <tr>
          <th style="width: 120px;">Date</th>
          <th style="width: 120px;">Amount</th>
          <th style="width: 200px;">Description</th>
          <th style="width: 200px;">Notes</th>
          <th style="width: 100px;">Actions</th>
        </tr>
      </thead>

      <tbody>
        {% for entry in entries %}
        <tr data-id="{{ entry.id }}">
          <td contenteditable="true" data-field="date">{{ entry.date }}</td>
          <td contenteditable="true" class="number" data-field="amount">{{ entry.amount }}</td>
          <td contenteditable="true" data-field="description">{{ entry.description or '' }}</td>
          <td contenteditable="true" data-field="notes">{{ entry.notes or '' }}</td>
          <td>
            <button class="save-btn" onclick="saveRow(this)" style="display:none;">Save</button>
            <button class="delete-btn" onclick="deleteRow(this)">Del</button>
          </td>
        </tr>
        {% endfor %}

        <tr id="input-row">
          <td><input id="input-date" type="date" required /></td>
          <td><input id="input-amount" type="number" step="0.01" required /></td>
          <td><input id="input-description" /></td>
          <td><input id="input-notes" /></td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="status-bar">
    <div id="status-message">Ready</div>
    <div id="entry-count">{{ entries|length }} entries</div>
  </div>

</div>

<script>
  const modifiedCells = new WeakMap();

  document.addEventListener('input', function(e) {
    if (e.target.hasAttribute('contenteditable')) {
      const row = e.target.closest('tr');
      const saveBtn = row.querySelector('.save-btn');
      if (saveBtn) {
        saveBtn.style.display = 'inline-block';
        modifiedCells.set(row, true);
      }
    }
  });

  document.getElementById('input-row').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      addEntry();
    }
  });

  document.getElementById('input-date').valueAsDate = new Date();
</script>

</body>
</html>
